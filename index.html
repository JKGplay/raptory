<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Raptory</title>
</head>

<body>
    <div class="container">
        <fieldset>
            <div class="formContainer">
                <form action="" method="" autocomplete="off" id="form">
                    <label for="velNum">Liczba raptorów: </label><br>
                    <input type="number" name="velNum" id="velNum" placeholder="Wpisz liczbę raptorów" value="8">
                    1&nbsp;<input class="inputRangeVelo slider" type="range" min="1" max="8" value="8">&nbsp;8
                    <br><br>
                    <label for="AC">KP przeciwnika: </label><br>
                    <input type="number" name="AC" id="AC" placeholder="Wpisz KP przeciwnika" value="10">
                    1&nbsp;<input class="inputRangeAC slider" type="range" min="1" max="30" value="10">&nbsp;30
                    <br>
                    <input type="button" value="Oblicz" name="btn" id="btn">
                </form>
            </div>
            <div>
                Łączne obrażenia: <span id="result"></span>
            </div>
        </fieldset>
    </div>
    <script>

        const myForm = document.getElementById("form");
        const btn = document.getElementById("btn");
        const span = document.getElementById("result");

        function submit() {
            if (!isNaN(myForm.velNum.value) && !isNaN(myForm.AC.value) && myForm.velNum.value > 0 && myForm.AC.value > 0) {
                span.innerHTML = numRaptor();
            } else {
                span.innerHTML = "Błąd";
            }
        }

        btn.addEventListener("click", submit);

        function rand(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }


        function raptor1() {
            let k20_1 = rand(1, 20);
            //echo '1. rzut:' . $k20_1;
            let k20_2 = rand(1, 20);
            //echo '<br>2. rzut:' . $k20_2;
            let dmg1 = 0;
            let dmg2 = 0;
            let dmg3 = 0;

            if (k20_1 == 20) {
                dmg2 += rand(1, 6) + rand(1, 6) + 2;
                //echo '<br>1. atak: obrażenia (krytyk): ' . $dmg2;
            } else if (k20_1 + 4 >= myForm.AC.value) {
                dmg2 += rand(1, 6) + 2;
                //echo '<br>1. atak: obrażenia:' . $dmg2;
            }

            if (k20_2 == 20) {
                dmg3 += rand(1, 4) + rand(1, 4) + 2;
                //echo '<br>2. atak: obrażenia (krytyk): ' . $dmg3;
            } else if (k20_2 + 4 >= myForm.AC.value) {
                dmg3 += rand(1, 4) + 2;
                //echo '<br>2. atak: obrażenia:' . $dmg3;
            }

            dmg1 = dmg2 + dmg3;
            //echo '<br>końcowe obrażenia: ' . $dmg1 . '<br>';
            return dmg1;
        }

        function raptor2() {
            let k20_1 = rand(1, 20);
            //echo '1. rzut:' . $k20_1;
            let k20_2 = rand(1, 20);
            //echo '<br>2. rzut:' . $k20_2;
            let k20_3 = rand(1, 20);
            //echo '<br>3. rzut:' . $k20_3;
            let k20_4 = rand(1, 20);
            //echo '<br>4. rzut:' . $k20_4;
            let dmg1 = 0;
            let dmg2 = 0;
            let dmg3 = 0;

            if ((k20_1 === 20) || (k20_2 === 20)) {
                dmg2 += rand(1, 6) + rand(1, 6) + 2;
                //echo '<br>1. atak: obrażenia (krytyk): ' . $dmg2;
            } else if ((k20_1 + 4 >= myForm.AC.value) || (k20_2 + 4 >= myForm.AC.value)) {
                dmg2 += rand(1, 6) + 2;
                //echo '<br>1. atak: obrażenia: ' . $dmg2;
            }

            if ((k20_3 === 20) || (k20_4 === 20)) {
                dmg3 += rand(1, 4) + rand(1, 4) + 2;
                //echo '<br>2. atak: obrażenia (krytyk): ' . $dmg2;
            } else if ((k20_3 + 4 >= myForm.AC.value) || (k20_4 + 4 >= myForm.AC.value)) {
                dmg3 += rand(1, 4) + 2;
                //echo '<br>2. atak: obrażenia: ' . $dmg2;
            }

            dmg1 = dmg2 + dmg3;
            //echo '<br>końcowe obrażenia: ' . $dmg1 . '<br><br><br>';
            return dmg1;
        }

        function numRaptor() {
            let dmgAll = 0;

            if (myForm.velNum.value > 1) {
                for (let i = 0; i < myForm.velNum.value; i++) {
                    dmgAll += raptor2();
                }
            } else {
                dmgAll = raptor1();
            }

            return dmgAll;
        }

        /////////////////////////////////////////////////////////////////
        var rangeVelo = document.querySelector('.inputRangeVelo');
        var fieldVelo = document.getElementById('velNum');

        rangeVelo.addEventListener('input', function (e) {
            fieldVelo.value = e.target.value;
        });
        fieldVelo.addEventListener('input', function (e) {
            rangeVelo.value = e.target.value;
        });

        var rangeAC = document.querySelector('.inputRangeAC');
        var fieldAC = document.getElementById('AC');

        rangeAC.addEventListener('input', function (e) {
            fieldAC.value = e.target.value;
        });
        fieldAC.addEventListener('input', function (e) {
            rangeAC.value = e.target.value;
        });
    </script>
</body>

</html>